services:
  # Component plugin manager.
  plugin.manager.ambientimpact_component:
    class: Drupal\ambientimpact_core\ComponentPluginManager
    parent: default_plugin_manager

  # Icon bundle plugin manager.
  plugin.manager.ambientimpact_icon_bundle:
    class: Drupal\ambientimpact_core\IconBundlePluginManager
    parent: default_plugin_manager

  # The Component HTML cache bin.
  cache.ambientimpact_component_html:
    class: Drupal\Core\Cache\CacheBackendInterface
    tags:
      - { name: cache.bin }
    factory: cache_factory:get
    arguments: [ambientimpact_component_html]

  # Description list hook_theme() event subscriber.
  ambientimpact_core.hook_theme_description_list_event_subscriber:
    class: \Drupal\ambientimpact_core\EventSubscriber\Theme\HookThemeDescriptionListEventSubscriber
    arguments: ['@module_handler']
    tags:
      - { name: 'event_subscriber' }

  # Icon hook_theme() event subscriber.
  ambientimpact_core.hook_theme_icon_event_subscriber:
    class: \Drupal\ambientimpact_core\EventSubscriber\Theme\HookThemeIconEventSubscriber
    arguments: ['@plugin.manager.ambientimpact_component', '@module_handler']
    tags:
      - { name: 'event_subscriber' }

  # Component libraries hook_library_info_alter() event subscriber.
  ambientimpact_core.hook_library_info_alter_component_libraries_event_subscriber:
    class: \Drupal\ambientimpact_core\EventSubscriber\Theme\HookLibraryInfoAlterComponentLibrariesEventSubscriber
    arguments: ['@plugin.manager.ambientimpact_component']
    tags:
      - { name: 'event_subscriber' }

  # Modernizr hook_library_info_alter() event subscriber.
  ambientimpact_core.hook_library_info_alter_modernizr_event_subscriber:
    class: \Drupal\ambientimpact_core\EventSubscriber\Theme\HookLibraryInfoAlterModernizrEventSubscriber
    arguments: ['@module_handler']
    tags:
      - { name: 'event_subscriber' }

  # hook_form_alter() event subscriber.
  ambientimpact_core.hook_form_alter_event_subscriber:
    class: \Drupal\ambientimpact_core\EventSubscriber\Form\HookFormAlterEventSubscriber
    arguments: []
    tags:
      - { name: 'event_subscriber' }

  # hook_page_attachments() event subscriber.
  ambientimpact_core.hook_page_attachments_event_subscriber:
    class: \Drupal\ambientimpact_core\EventSubscriber\Page\HookPageAttachmentsEventSubscriber
    arguments:
      - '@plugin.manager.ambientimpact_component'
      - '@theme.manager'
      - '@state'
    tags:
      - { name: 'event_subscriber' }

  # template_preprocess_html() event subscriber.
  ambientimpact_core.preprocess_html_event_subscriber:
    class: \Drupal\ambientimpact_core\EventSubscriber\Preprocess\PreprocessHTMLEventSubscriber
    arguments: ['@request_stack']
    tags:
      - { name: 'event_subscriber' }

  # ambientimpact_icon() Twig function.
  # Note that Twig extensions don't seem to correctly pass specific services, so
  # we must pass the service container itself for dependency injection to work:
  # @see https://stackoverflow.com/a/24938384
  ambientimpact_core.twig.ambientimpact_icon:
    class: Drupal\ambientimpact_core\Template\IconTwigExtension
    arguments: ['@service_container']
    tags:
      - { name: twig.extension }
