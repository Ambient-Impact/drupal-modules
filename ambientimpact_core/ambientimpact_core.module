<?php

/**
 * Implements hook_library_info_build().
 *
 * This returns the libraries defined in individual Ambient.Impact Components,
 * as returned by the 'plugin.manager.ambientimpact_component' service.
 *
 * @see \Drupal\ambientimpact_core\ComponentPluginManager::getComponentLibraries()
 *   Returns the value returned by this method.
 *
 * @see https://www.drupal.org/docs/8/creating-custom-modules/adding-stylesheets-css-and-javascript-js-to-a-drupal-8-module#dynamic-css-js
 */
function ambientimpact_core_library_info_build() {
	return
		\Drupal::service('plugin.manager.ambientimpact_component')
			->getComponentLibraries();
}

/**
 * Implements hook_element_info_alter().
 */
// function ambientimpact_core_element_info_alter(array &$info) {
// 	if (isset($info['toolbar'])) {
// 		$info['toolbar']['#attached']['library'][] =
// 			'ambientimpact_core/component.toolbar';
// 	}
// }

/**
 * Implements hook_field_formatter_info_alter().
 *
 * This replaces the 'video_embed_field_thumbnail' formatter class (if present)
 * with our own, which alters the video thumbnail render array to include a play
 * icon element. It doesn't seem possible currently to use this hook in a .theme
 * file, so we have to do this at the module level.
 *
 * @see \Drupal\ambientimpact_core\Plugin\Field\FieldFormatter\VideoEmbedFieldThumbnail
 *   Our thumbnail field formatter that extends the 'video_embed_field' one.
 */
function ambientimpact_core_field_formatter_info_alter(array &$info) {
  if (isset($info['video_embed_field_thumbnail'])) {
    $info['video_embed_field_thumbnail']['class'] =
      'Drupal\ambientimpact_core\Plugin\Field\FieldFormatter\VideoEmbedFieldThumbnail';
  }
}
